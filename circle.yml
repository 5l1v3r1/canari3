machine:
  python:
    version: 2.7.6
  services:
    - docker

dependencies:
  pre:
    - sudo apt-get update
    - sudo apt-get -y dist-upgrade
    - sudo apt-get install -y ca-certificates build-essential python-lxml python-dev python-setuptools python-pip
  override:
    - docker info
    - python setup.py install
#    - ./build_dockers.sh

test:
  override:
    - python setup.py test

deployment:
  release:
    tag: /v[0-9]+(\.[0-9]+)*/
    owner: redcanari
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push redcanari/canari
      - echo "[server-login]" > ~/.pypirc
      - echo "repository:https://pypi.python.org/pypi" >> ~/.pypirc
      - echo "username:$PYPI_USERNAME" >> ~/.pypirc
      - echo "password:$PYPI_PASSWORD" >> ~/.pypirc
      - python setup.py sdist upload